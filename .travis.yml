cache:
  yarn: true
  directories:
    - $HOME/.yarn-cache
    - node_modules
    - packages/mobile-app/node_modules
    - packages/mobile-ui/node_modules
# notifications:
#   email:
#     on_success: never
#     on_failure: always

matrix:
  include:
    # - language: swift
    #   os: osx
    #   osx_image: xcode11.1
    #   if: sender != "Travis CI"
    #   node_js: false
    #   before_install:
    #     - nvm install 10
    #     - node --version
    #     - npm install -g yarn
    #     - yarn -version
    #     - gem install fastlane
    #     - echo -e "machine github.com\n  login $GITHUB_API_TOKEN" >> ~/.netrc
    #   install:
    #     - yarn
    #     - yarn pods
    #     - cd packages/mobile-app/ios
    #     - bundle install
    #     - cd $TRAVIS_BUILD_DIR
    #   script:
    #     - cd packages/mobile-app/ios
    #     - bundle exec fastlane ios beta
    #     - cd $TRAVIS_BUILD_DIR
    #   after_success:
    #     - .travis/push.sh

    # Android
    - language: android
      if: sender != "Travis CI"
      os: linux
      jdk: oraclejdk8
      sudo: required
      android:
        components:
          - platform-tools
          - tools
          - build-tools-26.0.3
          - build-tools-28.0.3
          - android-21
          - android-26
          - android-28
          - sys-img-armeabi-v7a-android-21
          - extra-android-m2repository
          - extra-google-m2repository
          - extra-google-google_play_services
      node_js: false
      before_install:
        - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
        - nvm install 10
        - node --version
        - npm install -g yarn
        - yarn -version
        - gem install fastlane
        - echo -e "machine github.com\n  login $GITHUB_API_TOKEN" >> ~/.netrc
      install:
        - yarn
        - cd packages/mobile-app/android
        - bundle install
        - cd $TRAVIS_BUILD_DIR
      script:
        - cd packages/mobile-app/android
        - bundle exec fastlane android internal
        - cd $TRAVIS_BUILD_DIR
      after_success:
        - .travis/push.sh
